import{throttle}from"./throttle.js";import{isTouchDevice,deviceType}from"./checkDeviceType.js";isTouchDevice();const events={mouse:{down:"mousedown",move:"mousemove",up:"mouseup",click:"click"},touch:{down:"touchstart",move:"touchmove",up:"touchend",click:"click"}},createDesktop=()=>{const e=document.querySelector(".template"),t=document.querySelector(".desktop"),o=t.querySelector(".desktop__footer"),s=e.querySelector(".window"),c=e.querySelector(".reference"),i=e.querySelector(".file__icon--text"),n=e.querySelector(".file__icon--link"),l=e.querySelector(".file__icon--folder"),r=document.querySelectorAll(".file");r.forEach((e=>{const t=(o=e,o.classList.contains("file--text")?i:o.classList.contains("file--link")?n:o.classList.contains("file--folder")?l:void 0).cloneNode(!0);var o;const s=e.querySelector(".file__label"),c=e.querySelector(".file__name");s.insertBefore(t,c)}));let d,a=0,v=0,u=0,w=!1;const f=e=>{e.classList.remove("window--collapsed");const t=()=>{const t=Math.round(window.innerWidth*(window.innerWidth<800?.9:.7)),o=Math.round(window.innerHeight*(window.innerWidth<800?.7:.8));e.style.left=window.innerWidth/2+"px",e.style.top=window.innerHeight/2+"px",e.style.width=`${t}px`,e.style.height=`${o}px`};t(),window.addEventListener("resize",(()=>{t()}))},p=e=>{e.preventDefault(),e.target.classList.remove("file"),e.target.classList.add("file--opened");const i=e.target.querySelector(".file__label"),n=e.target.querySelector(".file__name"),l=e.target.querySelector(".file__icon").cloneNode(!0);l.classList.remove("file__icon--desktop");const r=s.cloneNode(!0),p=r.querySelector(".window__path"),_=r.querySelector(".window__header").querySelector(".window__draggable-area"),L=c.cloneNode(!0);p.textContent=n.textContent,_.insertBefore(l,p),t.appendChild(r),f(r),i.classList.add("file__label--active");const m=e.target.querySelector(".file__content").cloneNode(!0);r.appendChild(m),m.classList.remove("visually-hidden"),m.classList.add("window__content"),m.classList.remove("file__content"),e.target.classList.contains("file--folder")&&m.classList.add("grid--folder");const y=()=>{d=L;const e=a+1;r.style.zIndex=`${e}`,a=e,L.classList.add("reference--active"),t.querySelectorAll(".window--active").forEach((e=>{e.classList.remove("window--active")})),r.classList.add("window--active"),t.querySelectorAll(".reference").forEach((e=>{e===d?e.classList.add("reference--active"):e.classList.remove("reference--active")}))};y();const h=throttle((e=>{if(w){e.stopPropagation();const t=isTouchDevice()?e.touches[0].clientX:e.clientX,o=isTouchDevice()?e.touches[0].clientY:e.clientY,s=v-t,c=u-o,i=r.offsetLeft-s+"px",n=r.offsetTop-c+"px";r.style.left=i,r.style.top=n,v=t,u=o}}),10),g=()=>{document.removeEventListener(events[deviceType].move,h),document.removeEventListener(events[deviceType].up,g),w=!1},q=()=>{r.classList.contains("window--collapsed")?(r.classList.remove("window--collapsed"),y()):L===d?r.classList.add("window--collapsed"):y()},S=e.target.querySelector(".file__icon").cloneNode(!0);S.classList.remove("file__icon--desktop");const k=L.querySelector(".reference__text");k.textContent=n.textContent,L.insertBefore(S,k),o.appendChild(L),L.addEventListener(events[deviceType].click,q),r.addEventListener(events[deviceType].down,(e=>{e.target.closest(".window__draggable-area")&&(e=>{y(),e.stopPropagation(),e.cancelable&&e.preventDefault(),r.classList.contains("window--fullscreen")||(w=!0,v=isTouchDevice()?e.touches[0].clientX:e.clientX,u=isTouchDevice()?e.touches[0].clientY:e.clientY,document.addEventListener(events[deviceType].move,h),document.addEventListener(events[deviceType].up,g))})(e),e.target.closest(".window")&&y()})),r.addEventListener(events[deviceType].click,(t=>{t.target.closest(".window__button--collapse")&&q(),t.target.closest(".window__button--close")&&(e.target.classList.add("file"),e.target.classList.remove("file--opened"),y(),r.remove(),L.remove(),i.classList.remove("file__label--active")),t.target.closest(".window__button--expand")&&(y(),r.classList.contains("window--fullscreen")?r.classList.remove("window--fullscreen"):r.classList.add("window--fullscreen"))}))};o.addEventListener("wheel",(e=>{e.preventDefault(),o.scrollLeft+=e.deltaY})),t.addEventListener(events[deviceType].click,(e=>{e.target.closest(".file")&&!e.target.closest(".file--link")&&p(e)}))};export{createDesktop};