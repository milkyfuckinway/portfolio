import{throttle}from"./throttle.js";import{isTouchDevice,deviceType,events}from"./checkDeviceType.js";import{setPosition,setSize}from"./positionFunctions.js";const createDesktop=()=>{const e=document.querySelector(".template"),t=document.querySelector(".desktop"),s=t.querySelector(".desktop__footer"),o=e.querySelector(".window"),c=e.querySelector(".reference"),l=document.querySelectorAll(".file");l.forEach((t=>{const s=(t=>{const s=e.querySelector(".file__icon--text"),o=e.querySelector(".file__icon--link"),c=e.querySelector(".file__icon--folder");return t.classList.contains("file--text")?s:t.classList.contains("file--link")?o:t.classList.contains("file--folder")?c:void 0})(t).cloneNode(!0),o=t.querySelector(".file__label"),c=t.querySelector(".file__name");o.insertBefore(s,c)}));let i,n=0,r=0,a=0,d=!1;const v=e=>{e.preventDefault(),e.target.classList.remove("file"),e.target.classList.add("file--opened");const l=e.target.querySelector(".file__label"),v=e.target.querySelector(".file__name"),f=e.target.querySelector(".file__icon").cloneNode(!0);f.classList.remove("file__icon--desktop");const u=o.cloneNode(!0),p=u.querySelector(".window__path"),_=u.querySelector(".window__header").querySelector(".window__draggable-area"),L=c.cloneNode(!0);var w;p.textContent=v.textContent,_.insertBefore(f,p),t.appendChild(u),(w=u).classList.remove("window--collapsed"),setSize(),setPosition(w),l.classList.add("file__label--active");const y=e.target.querySelector(".file__content").cloneNode(!0);u.appendChild(y),y.classList.remove("visually-hidden"),y.classList.add("window__content"),y.classList.remove("file__content"),e.target.classList.contains("file--folder")&&y.classList.add("grid--folder");const m=()=>{i=L;const e=n+1;u.style.zIndex=`${e}`,n=e,L.classList.add("reference--active"),t.querySelectorAll(".window--active").forEach((e=>{e.classList.remove("window--active")})),u.classList.add("window--active"),t.querySelectorAll(".reference").forEach((e=>{e===i?e.classList.add("reference--active"):e.classList.remove("reference--active")}))};m();const g=throttle((e=>{if(d){e.stopPropagation();const t=isTouchDevice()?e.touches[0].clientX:e.clientX,s=isTouchDevice()?e.touches[0].clientY:e.clientY,o=r-t,c=a-s,l=u.offsetLeft-o+"px",i=u.offsetTop-c+"px";u.style.left=l,u.style.top=i,r=t,a=s}}),10),S=()=>{document.removeEventListener(events[deviceType].move,g),document.removeEventListener(events[deviceType].up,S),d=!1},h=()=>{u.classList.contains("window--collapsed")?(u.classList.remove("window--collapsed"),m()):L===i?u.classList.add("window--collapsed"):m()},q=e.target.querySelector(".file__icon").cloneNode(!0);q.classList.remove("file__icon--desktop");const T=L.querySelector(".reference__text");T.textContent=v.textContent,L.insertBefore(q,T),s.appendChild(L),L.addEventListener(events[deviceType].click,h),u.addEventListener(events[deviceType].down,(e=>{e.target.closest("[data-draggable-area]")&&(e=>{m(),e.stopPropagation(),e.cancelable&&e.preventDefault(),u.classList.contains("window--fullscreen")||(d=!0,r=isTouchDevice()?e.touches[0].clientX:e.clientX,a=isTouchDevice()?e.touches[0].clientY:e.clientY,document.addEventListener(events[deviceType].move,g),document.addEventListener(events[deviceType].up,S))})(e),e.target.closest(".window")&&m()})),u.addEventListener(events[deviceType].click,(t=>{t.target.closest("[data-button-collapse]")&&h(),t.target.closest("[data-button-close]")&&(e.target.classList.add("file"),e.target.classList.remove("file--opened"),m(),u.remove(),L.remove(),l.classList.remove("file__label--active")),t.target.closest("[data-button-expand]")&&(m(),u.classList.contains("window--fullscreen")?u.classList.remove("window--fullscreen"):u.classList.add("window--fullscreen"))}))};s.addEventListener("wheel",(e=>{e.preventDefault(),s.scrollLeft+=e.deltaY})),t.addEventListener(events[deviceType].click,(e=>{e.target.closest(".file")&&!e.target.closest(".file--link")&&v(e)}))};export{createDesktop};