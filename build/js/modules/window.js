import{throttle}from"./throttle.js";import{isTouchDevice,deviceType}from"./checkDeviceType.js";isTouchDevice();const createDesktop=()=>{const e={mouse:{down:"mousedown",move:"mousemove",up:"mouseup",click:"click"},touch:{down:"touchstart",move:"touchmove",up:"touchend",click:"click"}},t=document.querySelector(".template"),o=document.querySelector(".desktop"),c=o.querySelector(".desktop__footer"),s=t.querySelector(".window"),l=t.querySelector(".reference"),i=o.offsetWidth,n=o.offsetHeight,r=i/2,a=n/2,d=Math.round(window.innerWidth*(i<800?.9:.5)),f=Math.round(window.innerHeight*(i<800?.7:.5)),u=t.querySelector(".file__icon--text"),v=t.querySelector(".file__icon--link"),p=t.querySelector(".file__icon--folder"),w=document.querySelectorAll(".file");w.forEach((e=>{const t=(o=e,o.classList.contains("file--text")?u:o.classList.contains("file--link")?v:o.classList.contains("file--folder")?p:void 0).cloneNode(!0);var o;const c=e.querySelector(".file__label"),s=e.querySelector(".file__name");c.insertBefore(t,s)}));let _,m=0,y=0,L=0,h=!1,g=0,q=0,S=0,k=0;const T=t=>{t.preventDefault(),t.target.classList.remove("file"),t.target.classList.add("file--opened");const u=t.target.querySelector(".file__label"),v=t.target.querySelector(".file__name"),p=t.target.querySelector(".file__icon").cloneNode(!0);p.classList.remove("file__icon--desktop");const w=s.cloneNode(!0),T=w.querySelector(".window__path"),x=w.querySelector(".window__header").querySelector(".window__draggable-area"),D=l.cloneNode(!0);var E;T.textContent=v.textContent,x.insertBefore(p,T),o.appendChild(w),(E=w).classList.remove("window--collapsed"),E.style.left=`${r+q}px`,E.style.top=`${a+g}px`,E.style.width=`${d}px`,E.style.height=`${f}px`,q+(i-d)/2+10+d>=i?(q=0,k=0):(q+=8,k+=1),g+(n-f)/2+30+f>=n?(g=0,S=0):(g+=40,S+=1),u.classList.add("file__label--active");const b=t.target.querySelector(".file__content").cloneNode(!0);w.appendChild(b),b.classList.remove("visually-hidden"),b.classList.add("window__content"),b.classList.remove("file__content"),t.target.classList.contains("file--folder")&&b.classList.add("grid--folder");const C=()=>{_=D;const e=m+1;w.style.zIndex=`${e}`,m=e,D.classList.add("reference--active"),o.querySelectorAll(".window--active").forEach((e=>{e.classList.remove("window--active")})),w.classList.add("window--active"),o.querySelectorAll(".reference").forEach((e=>{e===_?e.classList.add("reference--active"):e.classList.remove("reference--active")}))};C();const N=throttle((e=>{if(h){e.stopPropagation();const t=isTouchDevice()?e.touches[0].clientX:e.clientX,o=isTouchDevice()?e.touches[0].clientY:e.clientY,c=y-t,s=L-o,l=w.offsetLeft-c+"px",i=w.offsetTop-s+"px";w.style.left=l,w.style.top=i,y=t,L=o}}),10),Y=()=>{document.removeEventListener(e[deviceType].move,N),document.removeEventListener(e[deviceType].up,Y),h=!1},$=()=>{w.classList.contains("window--collapsed")?(w.classList.remove("window--collapsed"),C()):D===_?w.classList.add("window--collapsed"):C()},X=t.target.querySelector(".file__icon").cloneNode(!0);X.classList.remove("file__icon--desktop");const A=D.querySelector(".reference__text");A.textContent=v.textContent,D.insertBefore(X,A),c.appendChild(D),D.addEventListener(e[deviceType].click,$),w.addEventListener(e[deviceType].down,(t=>{t.target.closest(".window__draggable-area")&&(t=>{C(),t.stopPropagation(),t.cancelable&&t.preventDefault(),w.classList.contains("window--fullscreen")||(h=!0,y=isTouchDevice()?t.touches[0].clientX:t.clientX,L=isTouchDevice()?t.touches[0].clientY:t.clientY,document.addEventListener(e[deviceType].move,N),document.addEventListener(e[deviceType].up,Y))})(t),t.target.closest(".window")&&C()})),w.addEventListener(e[deviceType].click,(e=>{e.target.closest(".window__button--collapse")&&$(),e.target.closest(".window__button--close")&&(t.target.classList.add("file"),t.target.classList.remove("file--opened"),C(),w.remove(),D.remove(),u.classList.remove("file__label--active"),S>0&&(S-=1,g-=40),k>0&&(k-=1,q-=10)),e.target.closest(".window__button--expand")&&(C(),w.classList.contains("window--fullscreen")?w.classList.remove("window--fullscreen"):w.classList.add("window--fullscreen"))}))};c.addEventListener("wheel",(e=>{e.preventDefault(),c.scrollLeft+=e.deltaY})),o.addEventListener(e[deviceType].click,(e=>{e.target.closest(".file")&&!e.target.closest(".file--link")&&T(e)}))};export{createDesktop};